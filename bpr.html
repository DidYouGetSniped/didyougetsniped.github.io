<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <title>Broker Performance Rating Explanation</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="bpr.css">
</head>
  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XGNQRLJMGK"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);} 
  gtag('js', new Date());
    
  gtag('config', 'G-XGNQRLJMGK');
</script>
<script type="module">
    // Import the function from the external file
    import { setRandomBackground } from './background.js';

    function calculateScore() {
        // ... (existing calculateScore function)
    }

    // Attach event listener to the button once the DOM is fully loaded
    document.addEventListener('DOMContentLoaded', () => {
        document.getElementById('calculate_button').addEventListener('click', calculateScore);
        // Also run calculation on load to show example
        calculateScore(); 
        
        // Call the imported function here
        setRandomBackground();
    });
</script>
<script>
document.addEventListener('DOMContentLoaded', function() {
  const style = document.createElement('style');
  // Cursor hotspot at the center for a 64x64 image
  // If your file name has a space, encode it or rename to avoid spaces.
  style.innerHTML = "* { cursor: url('wb kill.png') 32 32, auto !important; }";
  document.head.appendChild(style);
});
</script>
<body>
    <div class="container">
        <h1>Broker Performance Rating Explanation</h1>
        <p>This document provides a comprehensive breakdown of the <strong>Broker Performance Rating (BPR)</strong> calculation. BPR is designed to be a measure of a player's effectiveness, resilience, and overall game impact, moving beyond simple statistics to capture true skill and contribution. While it provides useful metrics, it <strong>does not account for intangibles</strong> like map knowledge, teamwork, or leadership. 
            Values for the calculator can be found <a href="https://didyougetsniped.github.io/wbinfo" target="_blank" rel="noopener">here</a>.</p>
        <div class="calculator">
            <h2>Interactive Performance Calculator</h2>
            <p>Try the example profile below of <a href="https://didyougetsniped.github.io/wbinfo?uid=5ab2a1a9fd3c7a5019977b68" target="_blank" rel="noopener">JoJa15</a> on 7/27/2025 or enter your own values!</p>
            <div class="input-group">
                <label for="total_kills">Total Kills:</label>
                <input type="number" id="total_kills" placeholder="e.g., 150167" value="150167">
            </div>
            <div class="input-group">
                <label for="damage_dealt">Total Damage Dealt:</label>
                <input type="number" id="damage_dealt" placeholder="e.g., 9515791" value="9515791">
            </div>
            <div class="input-group">
                <label for="total_deaths">Total Deaths:</label>
                <input type="number" id="total_deaths" placeholder="e.g., 38819" value="38819">
            </div>
            <div class="input-group">
                <label for="damage_received">Total Damage Received:</label>
                <input type="number" id="damage_received" placeholder="e.g., 21487962" value="21487962">
            </div>
            <div class="input-group">
                <label for="kills_top_placement_input">'Top X%' for Kills ELO (e.g., 1.0832 for Top 1.0832%):</label>
                <input type="number" step="any" id="kills_top_placement_input" placeholder="e.g., 1.0832" value="1.0832">
            </div>
            <div class="input-group">
                <label for="games_top_placement_input">'Top X%' for Games ELO (e.g., 0.1465 for Top 0.1465%):</label>
                <input type="number" step="any" id="games_top_placement_input" placeholder="e.g., 0.1465" value="0.1465">
            </div>
            <div class="input-group">
                <label for="total_games">Total Games Played:</label>
                <input type="number" id="total_games" placeholder="e.g., 6270" value="6270">
            </div>
            <div class="input-group">
                <label for="num_self_destructs">Number of Self Destructs:</label>
                <input type="number" id="num_self_destructs" placeholder="e.g., 460" value="460">
            </div>
            <div class="input-group">
                <label for="xp">Total XP:</label>
                <input type="number" id="xp" placeholder="e.g., 25441015" value="25441015">
            </div>
            <button id="calculate_button">Calculate Performance Score</button>
            <div id="calculation_result" class="result">
                Enter values and click 'Calculate'
            </div>
        </div>

        <h2>The Formulas in Detail</h2>
        <p>The overall performance score is a sum of two primary components, scaled by 100:</p>

        <div class="formula-block">
            <p><strong>Overall Performance Score</strong></p>
            <div class="formula-line centered-formula">
                <code>Overall Score = (Core Performance Score + Experience Bonus) &times; 100</code>
            </div>

            <p><strong>Core Performance Score</strong></p>
            <p>This is the central part of the calculation, combining combat skills and game impact:</p>
            <div class="formula-line centered-formula">
                <code>Core Performance Score = &radic;(Factor A &times; Factor B)</code>
            </div>

            <p>Where:</p>

            <p><strong>Factor A: Combat Skills</strong></p>
            <p>This factor assesses a player's direct combat prowess.</p>
            <div class="formula-line centered-formula">
                <code>Factor A = &radic;(Combat Efficiency) + Kills ELO Bonus</code>
            </div>
            <p>With sub-components:</p>
            <div class="formula-line centered-formula">
                <code>Combat Efficiency = (total_kills &times; damage_dealt) / (total_deaths &times; damage_received)</code>
                <code>Kills ELO Bonus = (1 / kills_elo_rank)^(1/4) / 6.2</code>
            </div>

            <p><strong>Factor B: Game Impact & Resilience</strong></p>
            <p>This factor evaluates contribution, longevity, and survivability.</p>
            <div class="formula-line centered-formula">
                <code>Factor B = Avg Damage Impact + Games ELO Bonus + Resilience</code>
            </div>
            <p>With sub-components:</p>
            <div class="formula-line centered-formula">
                <code>Avg Damage Impact = damage_dealt / (8250 &times; total_games)</code>
                <code>Games ELO Bonus = (1 / games_elo_rank)^(1/4) / 13.2</code>
                <code>Resilience = (damage_received &times; (1 - self_destruct_percentage)) / (660 &times; total_deaths)</code>
            </div>
            <p>And specifically for Resilience:</p>
            <div class="formula-line centered-formula">
                <code>self_destruct_percentage = num_self_destructs / total_deaths</code>
            </div>

            <p><strong>Experience Bonus</strong></p>
            <p>A minor additional score based on accumulated experience.</p>
            <div class="formula-line centered-formula">
                <code>Experience Bonus = (xp)^(1/4) / 62</code>
            </div>
        </div>

        <div class="explanation">
            <h2>1. Core Performance Score Explained</h2>
            <p>This is the central pillar of the rating, evaluating a player's direct combat prowess and ability to impact the game while surviving. It is calculated as the square root of the product of two distinct factors:</p>
            <p><code>Core Performance Score = &radic;(Factor A &times; Factor B)</code></p>
            <p>This multiplicative structure means a player must perform well in both Factor A (Combat Effectiveness) AND Factor B (Game Impact & Resilience) to achieve a high score. Excelling in only one area will limit the overall core performance score.</p>

            <h3>Factor A: Combat Effectiveness</h3>
            <p>This factor quantifies a player's direct combat skill, combining their damage-weighted K/D ratio with an ELO-based ranking bonus for kills.</p>

            <h4>A.1. Damage-Weighted K/D Ratio (<code style="white-space: normal;">Combat Efficiency</code>)</h4>
            <p><code>Combat Efficiency = (total_kills &times; damage_dealt) / (total_deaths &times; damage_received)</code></p>
            <ul>
                <li><strong>Beyond Simple K/D:</strong> Unlike a standard Kill/Death ratio, this metric deeply integrates damage numbers. It rewards players who not only get kills but also contribute significantly to damage output, and who do so efficiently by taking less damage themselves.</li>
                <li><strong>Numerator (<code style="white-space: normal;">total_kills &times; damage_dealt</code>):</strong> This powerfully emphasizes offensive contribution. A kill with high damage dealt is weighted much more heavily than a kill with low damage dealt (a stolen kill).</li>
                <li><strong>Denominator (<code style="white-space: normal;">total_deaths &times; damage_received</code>):</strong> This part penalizes inefficiency. Taking a lot of damage or getting killed will significantly reduce this ratio.</li>
                <li><strong>Square Root in Factor A:</strong> The square root of the `Combat Efficiency` is taken to normalize its contribution, preventing extreme values from dominating `Factor A`.</li>
            </ul>

            <h4>A.2. Kills ELO Bonus</h4>
            <p><code>Kills ELO Bonus = (1 / kills_elo_rank)^(1/4) / 6.2</code></p>
            <ul>
                <li><strong>Rewarding Top Tier Killers:</strong> This component provides a significant boost to players with a high rank (a small 'Top %' value) in kills ELO.</li>
                <li><strong>Inverse & Dampened:</strong> It uses the inverse of the rank (`1 / kills_elo_rank`), which is then heavily dampened by a fourth root `^(1/4)` to provide a powerful but controlled bonus for elite players.</li>
            </ul>

            <h3>Factor B: Game Impact & Resilience</h3>
            <p>This factor assesses a player's sustained contribution, longevity, and ability to absorb damage before falling in combat.</p>

            <h4>B.1. Average Damage Impact</h4>
            <p><code>Avg Damage Impact = damage_dealt / (8250 &times; total_games)</code></p>
            <ul>
                <li><strong>Damage Consistency:</strong> This calculates a player's average damage contribution per game. It rewards players who consistently deal high damage.</li>
                <li><strong>Normalization Constant (<code>8250</code>):</strong> The constant has been updated to `8250` to rebalance its weight within `Factor B`.</li>
            </ul>

            <h4>B.2. Games ELO Bonus</h4>
            <p><code>Games ELO Bonus = (1 / games_elo_rank)^(1/4) / 13.2</code></p>
            <ul>
                <li><strong>Rewarding Experience & Longevity:</strong> This component provides a significant boost to players with a high rank (a small 'Top %' value) in Games ELO.</li>
                <li><strong>Balanced Contribution:</strong> Like the Kills ELO bonus, it uses a dampened inverse `(1 / games_elo_rank)^(1/4)` to reward top players, with a scaling factor of `13.2` to balance its impact.</li>
            </ul>

            <h4>B.3. Resilience</h4>
            <p>First, we calculate the percentage of deaths that were self-inflicted: <code>self_destruct_percentage = num_self_destructs / total_deaths</code></p>
            <p>Then, Resilience is calculated as: <code>Resilience = (damage_received &times; (1 - self_destruct_percentage)) / (660 &times; total_deaths)</code></p>
            <ul>
                <li><strong>Effective Survivability:</strong> This measures how much damage a player can absorb per *legitimate* death (excluding self-destructs).</li>
                <li><strong>Normalization Constant (<code>660</code>):</strong> The constant is updated to `660` to adjust its weighting in the new `Factor B` structure.</li>
            </ul>

            <h2>2. Experience Bonus Explained</h2>
            <p><code>Experience Bonus = (xp)^(1/4) / 62</code></p>
            <ul>
                <li><strong>Acknowledging Dedication:</strong> This component provides a supplementary bonus for total experience points earned, and is dampened by a fourth root to ensure skill remains the primary driver of the score. This component is unchanged.</li>
            </ul>

            <h2>3. Final Score Scaling</h2>
            <p><code>Overall Score = (Core Performance Score + Experience Bonus) &times; 100</code></p>
            <ul>
                <li>The entire calculated score is multiplied by 100 to convert it from a small decimal (e.g., 1.25) into a more intuitive, larger number (e.g., 125.000). This makes the score easier to read and compare.</li>
            </ul>

            <div class="highlight">
                <h3>What does a low BPR score look like?</h3>
                <p>Here is an example of a player with a BPR of <strong>100</strong>, representing a player who is likely new and struggling with game mechanics.</p>
                <ul>
                    <li><strong>Total Kills:</strong> 10</li>
                    <li><strong>Damage Dealt:</strong> 10,000</li>
                    <li><strong>Total Deaths:</strong> 30</li>
                    <li><strong>Damage Received:</strong> 14,000</li>
                    <li><strong>'Top X%' for Kills ELO:</strong> 80%</li>
                    <li><strong>'Top X%' for Games ELO:</strong> 90%</li>
                    <li><strong>Total Games Played:</strong> 5</li>
                    <li><strong>Number of Self Destructs:</strong> 4</li>
                    <li><strong>Total XP:</strong> 32,270</li>
                </ul>
                <p>This profile exemplifies a player with a very low K/D ratio, poor combat efficiency, 
                    and a low rank in both Kills ELO and Games ELO.</p>
            </div>
                <h2>Note to Squad Leaders and Playtesters</h2>
            <p><strong>Broker Performance Rating (BPR)</strong> offers a useful snapshot of a player's skill, but it shouldn't be the sole factor when evaluating potential squad members. While BPR provides a general performance estimate, it doesn't capture elements like tactical awareness, teamwork, or adaptability. To get a more complete picture, leaders should examine additional statistics such as K/D ratio and ELOâ€”though it's important to note that ELO can be inflated through farming. 
                A high ELO doesn't always equate to a good player. For the most accurate assessment, reviewing a player's full stat profile and conducting a playtest remains the best approach. A playtest allows leaders to observe firsthand how well a player communicates, follows strategies, and contributes to the team beyond raw numbers.</p>
                <h2>Final Thoughts</h2>
            <p>The selection of specific numerical weights like 13.2 or 6.2 in the <strong>Broker Performance Rating (BPR)</strong> 
                formula is the result of a rigorous, evidence-based process designed to balance 
                quantitative analysis and practical considerations. These weights are not arbitrary but are 
                carefully calibrated to reflect the relative importance of each metric in driving overall broker performance.</p>
        </div>
        <footer>
      <p>Thanks to EpicFeathers for his contributions, Pomp for his API, and What U Died and TheChillTankMain for their photos.</p>
      <p>Disclaimer: This is a third-party project and is not affiliated with, endorsed, or sponsored by War Brokers or its developers.</p>
    </footer>
    </div>

    <script>
        function calculateScore() {
            // Get input values and convert to numbers, removing commas
            const total_kills = parseInt(document.getElementById('total_kills').value.replace(/,/g, ''));
            const damage_dealt = parseFloat(document.getElementById('damage_dealt').value.replace(/,/g, ''));
            const total_deaths = parseInt(document.getElementById('total_deaths').value.replace(/,/g, ''));
            const damage_received = parseFloat(document.getElementById('damage_received').value.replace(/,/g, ''));
            const kills_top_placement_input = parseFloat(document.getElementById('kills_top_placement_input').value.replace(/,/g, ''));
            const games_top_placement_input = parseFloat(document.getElementById('games_top_placement_input').value.replace(/,/g, ''));
            const total_games = parseInt(document.getElementById('total_games').value.replace(/,/g, ''));
            const num_self_destructs = parseInt(document.getElementById('num_self_destructs').value.replace(/,/g, ''));
            const xp = parseFloat(document.getElementById('xp').value.replace(/,/g, ''));

            const resultDiv = document.getElementById('calculation_result');
            resultDiv.innerHTML = ''; // Clear previous results
            resultDiv.className = 'result'; // Reset class for styling

            // Input Validation
            if (isNaN(total_kills) || isNaN(damage_dealt) || isNaN(total_deaths) ||
                isNaN(damage_received) || isNaN(kills_top_placement_input) || isNaN(games_top_placement_input) ||
                isNaN(total_games) || isNaN(num_self_destructs) || isNaN(xp)) {
                resultDiv.innerHTML = '<p>Error: Please fill in all fields with valid numbers.</p>';
                resultDiv.classList.add('error');
                return;
            }

            if (total_deaths === 0) {
                resultDiv.innerHTML = '<p>Error: Total Deaths cannot be zero.</p>';
                resultDiv.classList.add('error');
                return;
            }
            if (damage_received === 0) {
                resultDiv.innerHTML = '<p>Error: Damage Received cannot be zero.</p>';
                resultDiv.classList.add('error');
                return;
            }
            if (kills_top_placement_input === 0 || games_top_placement_input === 0) {
                resultDiv.innerHTML = '<p>Error: ELO Rank (\'Top %\') values cannot be zero.</p>';
                resultDiv.classList.add('error');
                return;
            }
            if (total_games === 0) {
                resultDiv.innerHTML = '<p>Error: Total Games cannot be zero.</p>';
                resultDiv.classList.add('error');
                return;
            }
            if (!(kills_top_placement_input > 0 && kills_top_placement_input <= 100) || !(games_top_placement_input > 0 && games_top_placement_input <= 100)) {
                resultDiv.innerHTML = '<p>Error: \'Top %\' placements must be between 0 (exclusive) and 100.</p>';
                resultDiv.classList.add('error');
                return;
            }
            if (num_self_destructs > total_deaths) {
                resultDiv.innerHTML = '<p>Error: Self destructs cannot exceed total deaths.</p>';
                resultDiv.classList.add('error');
                return;
            }
            if (total_kills < 0 || damage_dealt < 0 || total_deaths < 0 || damage_received < 0 ||
                total_games < 0 || num_self_destructs < 0 || xp < 0) {
                resultDiv.innerHTML = '<p>Error: All input values must be non-negative.</p>';
                resultDiv.classList.add('error');
                return;
            }

            // Convert ELO ranks (from percentage to decimal)
            const kills_elo_rank = kills_top_placement_input / 100.0;
            const games_elo_rank = games_top_placement_input / 100.0;

            // Perform Calculation (porting Python logic to JavaScript Math functions)
            try {
                const self_destruct_percentage = num_self_destructs / total_deaths;

                // Factor A: Combat Effectiveness
                const combat_efficiency = (total_kills * damage_dealt) / (total_deaths * damage_received);
                const kills_elo_bonus = (Math.pow(1 / kills_elo_rank, 1 / 4)) / 6.2;
                const factor_a = Math.sqrt(combat_efficiency) + kills_elo_bonus;

                // Factor B: Game Impact & Resilience
                const avg_damage_impact = damage_dealt / (8250 * total_games);
                const games_elo_bonus = (Math.pow(1 / games_elo_rank, 1 / 4)) / 13.2;
                const resilience = (damage_received * (1 - self_destruct_percentage)) / (660 * total_deaths);
                const factor_b = avg_damage_impact + games_elo_bonus + resilience;

                // Core Performance Score
                const core_performance_score = Math.sqrt(factor_a * factor_b);

                // Experience Bonus
                const experience_bonus = (Math.pow(xp, 1 / 4)) / 62;

                // Final Calculation
                const base_score = core_performance_score + experience_bonus;
                const overall_score = base_score * 100;

                // Display Result
                resultDiv.innerHTML = `<p>Broker Performance Rating: <strong>${overall_score.toFixed(3)}</strong></p>`;
                resultDiv.classList.add('success-result');

            } catch (e) {
                resultDiv.innerHTML = `<p>An unexpected error occurred during calculation: ${e.message}</p>`;
                resultDiv.classList.add('error');
            }
        }

        // Attach event listener to the button once the DOM is fully loaded
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('calculate_button').addEventListener('click', calculateScore);
            // Also run calculation on load to show example
            calculateScore(); 
        });
    </script>
</body>
</html>