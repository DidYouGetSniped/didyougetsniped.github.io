<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>War Brokers Server Mapper</title>
       <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&display=swap" rel="stylesheet">

    <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-XGNQRLJMGK"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-XGNQRLJMGK');
  </script>

    <style>
/* ============================================
   WAR BROKERS MAPPER — 2026 TACTICAL UI
   ============================================ */

:root {
  --bg:         #080b10;
  --bg2:        #0d1118;
  --bg3:        #121822;
  --panel:      #0f1520;
  --border:     #1e2d40;
  --border2:    #2a3f56;
  --amber:      #f5a623;
  --amber-dim:  #a36b0f;
  --amber-glow: rgba(245,166,35,0.18);
  --amber-glow2:rgba(245,166,35,0.06);
  --green:      #39d353;
  --green-dim:  #1a6628;
  --red:        #e63946;
  --red-dim:    #7a1520;
  --text:       #d8e0ea;
  --text-dim:   #6b7d90;
  --text-bright:#ffffff;
  --mono:       'JetBrains Mono', monospace;
  --display:    'JetBrains Mono', monospace;
  --body:       'JetBrains Mono', monospace;
}

*, *::before, *::after {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

html, body {
  height: 100%;
  background: var(--bg);
  color: var(--text);
  font-family: var(--body);
  font-size: 15px;
  overflow-x: hidden;
}

/* ============ ATMOSPHERIC EFFECTS ============ */
.scanlines {
  pointer-events: none;
  position: fixed;
  inset: 0;
  z-index: 9998;
  background: repeating-linear-gradient(
    0deg,
    transparent,
    transparent 2px,
    rgba(0,0,0,0.08) 2px,
    rgba(0,0,0,0.08) 4px
  );
}
.noise {
  pointer-events: none;
  position: fixed;
  inset: 0;
  z-index: 9997;
  opacity: 0.03;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");
  background-size: 150px;
}

/* ============ APP SHELL ============ */
#app {
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  padding-bottom: 48px;
}

/* ============ HEADER ============ */
#hdr {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 16px 24px;
  background: var(--panel);
  border-bottom: 1px solid var(--border2);
  box-shadow: 0 4px 32px rgba(0,0,0,0.6), 0 1px 0 var(--amber-dim);
  position: relative;
  overflow: hidden;
}

#hdr::before {
  content: '';
  position: absolute;
  bottom: 0; left: 0; right: 0;
  height: 2px;
  background: linear-gradient(90deg, transparent, var(--amber), transparent);
  animation: scan-line 4s ease-in-out infinite;
}

@keyframes scan-line {
  0%   { opacity: 0.4; transform: scaleX(0.3); }
  50%  { opacity: 1;   transform: scaleX(1); }
  100% { opacity: 0.4; transform: scaleX(0.3); }
}

.hdr-left {
  display: flex;
  align-items: center;
  gap: 20px;
}

.logo-wrap img {
  height: 72px;
  width: 72px;
  object-fit: contain;
  filter: drop-shadow(0 0 12px rgba(245,166,35,0.5));
  transition: filter 0.3s;
}
.logo-wrap img:hover {
  filter: drop-shadow(0 0 20px rgba(245,166,35,0.9));
}

.title-wrap {
  display: flex;
  flex-direction: column;
  gap: 2px;
}

h1 {
  font-family: var(--display);
  font-size: 22px;
  font-weight: 700;
  line-height: 1.15;
  color: var(--text-bright);
  text-shadow: 0 0 30px rgba(245,166,35,0.3);
  letter-spacing: 1px;
}

h1 .title-sub {
  font-size: 14px;
  font-weight: 600;
  color: var(--amber);
  letter-spacing: 4px;
}

.title-ver {
  font-family: var(--mono);
  font-size: 10px;
  color: var(--text-dim);
  letter-spacing: 2px;
}

.hdr-right {
  display: flex;
  align-items: center;
  gap: 16px;
  position: relative;
}

.hdr-stat {
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  gap: 2px;
}
.stat-label {
  font-family: var(--mono);
  font-size: 9px;
  color: var(--text-dim);
  letter-spacing: 3px;
}
.stat-val {
  font-family: var(--mono);
  font-size: 13px;
  color: var(--amber);
  letter-spacing: 2px;
  text-shadow: 0 0 10px var(--amber);
}

/* ============ MAIN LAYOUT ============ */
#main-layout {
  display: flex;
  flex: 1;
  gap: 0;
  align-items: stretch;
  min-height: calc(100vh - 112px - 48px);
}

/* ============ SETTINGS PANEL ============ */
#settings-panel {
  width: 50%;
  min-width: 340px;
  background: var(--panel);
  border-right: 1px solid var(--border2);
  padding: 0 0 16px 0;
  display: flex;
  flex-direction: column;
  flex-shrink: 0;
  overflow-y: auto;
}

.panel-label {
  font-family: var(--mono);
  font-size: 9px;
  letter-spacing: 4px;
  color: var(--text-dim);
  padding: 10px 20px 8px;
  border-bottom: 1px solid var(--border);
  background: var(--bg2);
}

/* ============ CFG ROW ============ */
.cfg-row {
  display: flex;
  align-items: flex-end;
  gap: 12px;
  padding: 14px 20px;
  border-bottom: 1px solid var(--border);
  flex-wrap: wrap;
}

.field-group {
  display: flex;
  flex-direction: column;
  gap: 5px;
}

.field-label {
  font-family: var(--mono);
  font-size: 9px;
  color: var(--amber);
  letter-spacing: 3px;
}

/* ============ SELECTS ============ */
.select-wrap {
  position: relative;
  display: inline-flex;
  align-items: center;
}

.select-wrap select {
  appearance: none;
  background: var(--bg3);
  border: 1px solid var(--border2);
  color: var(--text);
  font-family: var(--mono);
  font-size: 12px;
  padding: 7px 28px 7px 10px;
  border-radius: 2px;
  cursor: pointer;
  transition: border-color 0.2s, box-shadow 0.2s;
  min-width: 110px;
}
.select-wrap select:focus {
  outline: none;
  border-color: var(--amber);
  box-shadow: 0 0 0 2px var(--amber-glow);
}
.select-wrap select:hover {
  border-color: var(--amber-dim);
}

.select-arrow {
  position: absolute;
  right: 8px;
  color: var(--amber-dim);
  pointer-events: none;
  font-size: 12px;
}

.select-wrap.narrow select {
  min-width: 60px;
}

/* ============ TOGGLE SWITCH ============ */
.toggle-group {
  align-items: center;
}

.toggle {
  cursor: pointer;
  display: flex;
  align-items: center;
}
.toggle input { display: none; }

.toggle-track {
  width: 40px;
  height: 22px;
  background: var(--bg3);
  border: 1px solid var(--border2);
  border-radius: 11px;
  position: relative;
  transition: background 0.25s, border-color 0.25s;
  display: flex;
  align-items: center;
}
.toggle input:checked + .toggle-track {
  background: var(--green-dim);
  border-color: var(--green);
  box-shadow: 0 0 8px rgba(57,211,83,0.3);
}
.toggle-thumb {
  width: 14px;
  height: 14px;
  background: var(--text-dim);
  border-radius: 50%;
  position: absolute;
  left: 3px;
  transition: transform 0.25s, background 0.25s;
}
.toggle input:checked + .toggle-track .toggle-thumb {
  transform: translateX(18px);
  background: var(--green);
}

/* ============ SAVE BUTTON ============ */
#save {
  background: transparent;
  border: 1px solid var(--amber-dim);
  color: var(--amber);
  font-family: var(--mono);
  font-size: 11px;
  letter-spacing: 1px;
  padding: 7px 12px;
  border-radius: 2px;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 5px;
  transition: all 0.2s;
  white-space: nowrap;
}
#save:hover {
  background: var(--amber-glow2);
  border-color: var(--amber);
  box-shadow: 0 0 12px var(--amber-glow);
}
.btn-icon { font-size: 13px; }

/* ============ CFG SECTIONS ============ */
.cfg-section {
  border-bottom: 1px solid var(--border);
}

.section-header {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 11px 20px;
  background: var(--bg2);
}
.section-header.collapsible {
  cursor: pointer;
  user-select: none;
  transition: background 0.15s;
}
.section-header.collapsible:hover {
  background: var(--bg3);
}

.section-tag {
  font-family: var(--mono);
  font-size: 10px;
  color: var(--amber-dim);
  letter-spacing: 1px;
}

.section-title {
  font-family: var(--display);
  font-size: 11px;
  font-weight: 600;
  color: var(--text);
  letter-spacing: 2px;
  flex: 1;
}
.section-all {
  font-family: var(--mono);
  font-size: 10px;
  color: var(--amber);
  max-width: 200px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  text-align: right;
}
.chevron {
  width: 16px;
  height: 16px;
  opacity: 0.6;
  flex-shrink: 0;
  color: var(--text-dim);
  transition: transform 0.25s ease, opacity 0.2s;
}
.chevron.open {
  transform: rotate(180deg);
  opacity: 1;
  color: var(--amber);
}

/* ============ PLAYERS ROW ============ */
.players-row {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 12px 20px;
  flex-wrap: wrap;
}
.players-label {
  font-family: var(--mono);
  font-size: 11px;
  color: var(--text-dim);
  letter-spacing: 1px;
}

/* ============ FILTER BODY ============ */
._add {
  display: none;
}
.filter-body {
  display: flex;
  height: 240px;
  border-top: 1px solid var(--border);
}

._select {
  width: 48%;
  background: var(--bg);
  border-right: 1px solid var(--border);
  overflow-y: auto;
  display: flex;
  flex-direction: column;
  gap: 2px;
  padding: 4px;
}
._select::-webkit-scrollbar { width: 4px; }
._select::-webkit-scrollbar-thumb { background: var(--border2); border-radius: 2px; }

._select span {
  background: var(--bg3);
  border: 1px solid var(--border);
  padding: 4px 8px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  border-radius: 2px;
  font-family: var(--mono);
  font-size: 11px;
  color: var(--amber);
  animation: slide-in 0.15s ease;
}
@keyframes slide-in {
  from { opacity: 0; transform: translateX(-4px); }
  to   { opacity: 1; transform: translateX(0); }
}
._select span a { flex: 1; text-align: left; }
._select span button {
  background: transparent;
  border: none;
  color: var(--red);
  cursor: pointer;
  font-size: 11px;
  padding: 0 0 0 6px;
  opacity: 0.6;
  transition: opacity 0.15s;
}
._select span button:hover { opacity: 1; }

._find {
  width: 52%;
  display: flex;
  flex-direction: column;
}

.search-bar {
  display: flex;
  align-items: center;
  padding: 6px 8px;
  border-bottom: 1px solid var(--border);
  background: var(--bg2);
  gap: 4px;
}
.search-icon {
  color: var(--text-dim);
  font-size: 14px;
  flex-shrink: 0;
}
.search-input {
  flex: 1;
  background: transparent;
  border: none;
  outline: none;
  color: var(--text);
  font-family: var(--mono);
  font-size: 11px;
}
.search-input::placeholder { color: var(--text-dim); }
.clear-btn {
  background: transparent;
  border: none;
  color: var(--text-dim);
  cursor: pointer;
  font-size: 11px;
  padding: 2px 4px;
  transition: color 0.15s;
}
.clear-btn:hover { color: var(--red); }

._list {
  overflow-y: auto;
  flex: 1;
  display: flex;
  flex-direction: column;
}
._list::-webkit-scrollbar { width: 4px; }
._list::-webkit-scrollbar-thumb { background: var(--border2); border-radius: 2px; }

._list button {
  background: transparent;
  border: none;
  border-bottom: 1px solid var(--border);
  color: var(--text);
  font-family: var(--mono);
  font-size: 11px;
  padding: 8px 12px;
  text-align: left;
  cursor: pointer;
  transition: background 0.1s, color 0.1s;
  letter-spacing: 0.5px;
}
._list button:hover:not(:disabled) {
  background: var(--amber-glow2);
  color: var(--amber);
}
._list button:disabled {
  opacity: 0.3;
  cursor: default;
  text-decoration: line-through;
}

/* ============ START/STOP BUTTON ============ */
.startstop-btn {
  margin: 16px 20px 0;
  width: calc(100% - 40px);
  padding: 14px;
  background: linear-gradient(135deg, #0d3318, #124a22);
  border: 1px solid var(--green);
  color: var(--green);
  font-family: var(--display);
  font-size: 14px;
  font-weight: 700;
  letter-spacing: 3px;
  cursor: pointer;
  border-radius: 2px;
  position: relative;
  overflow: hidden;
  transition: all 0.25s;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  box-shadow: 0 0 20px rgba(57,211,83,0.15), inset 0 0 20px rgba(57,211,83,0.05);
}
.startstop-btn:hover {
  background: linear-gradient(135deg, #0f4020, #165c28);
  box-shadow: 0 0 30px rgba(57,211,83,0.3), inset 0 0 20px rgba(57,211,83,0.1);
}
.startstop-btn:disabled {
  background: var(--bg3);
  border-color: var(--border2);
  color: var(--text-dim);
  box-shadow: none;
  cursor: not-allowed;
}

.startstop-btn[value="stop"] {
  background: linear-gradient(135deg, #3a0d12, #5a1520);
  border-color: var(--red);
  color: var(--red);
  box-shadow: 0 0 20px rgba(230,57,70,0.15), inset 0 0 20px rgba(230,57,70,0.05);
}

.btn-pulse {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: var(--green);
  box-shadow: 0 0 6px var(--green);
  animation: pulse-dot 1.2s ease-in-out infinite;
  display: none;
}
.startstop-btn[value="stop"] .btn-pulse {
  display: block;
  background: var(--red);
  box-shadow: 0 0 6px var(--red);
  animation: none;
}
@keyframes pulse-dot {
  0%, 100% { opacity: 1; transform: scale(1); }
  50%       { opacity: 0.4; transform: scale(0.7); }
}

/* ============ OUTPUT PANEL ============ */
#output-panel {
  flex: 1;
  display: flex;
  flex-direction: column;
  background: var(--bg);
  overflow-y: auto;
}

#output-inner {
  flex: 1;
  padding: 32px;
  position: relative;
  display: flex;
  flex-direction: column;
}

.output-idle {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  flex: 1;
  min-height: 400px;
  gap: 16px;
  opacity: 0.35;
  pointer-events: none;
}
.idle-icon {
  font-size: 72px;
  color: var(--amber);
  animation: idle-spin 6s linear infinite;
}
@keyframes idle-spin {
  0%   { transform: rotate(0deg); opacity: 0.6; }
  50%  { opacity: 1; }
  100% { transform: rotate(360deg); opacity: 0.6; }
}
.idle-text {
  font-family: var(--display);
  font-size: 22px;
  letter-spacing: 6px;
  color: var(--amber);
}
.idle-sub {
  font-family: var(--mono);
  font-size: 13px;
  color: var(--text-dim);
  letter-spacing: 1px;
}

/* ============ OUTPUT RESULTS ============ */
#output {
  padding: 0 32px 32px;
}

#output ul {
  list-style: none;
  display: flex;
  flex-direction: column;
  gap: 8px;
}

#output li {
  font-family: var(--mono);
  font-size: 14px;
  color: var(--text);
  background: var(--panel);
  border: 1px solid var(--border2);
  border-left: 4px solid var(--amber);
  padding: 14px 20px;
  border-radius: 2px;
  letter-spacing: 0.5px;
  animation: result-in 0.2s ease;
  transition: background 0.15s;
}
#output li:hover {
  background: var(--bg3);
}
@keyframes result-in {
  from { opacity: 0; transform: translateX(8px); }
  to   { opacity: 1; transform: translateX(0); }
}

#output .match-summary {
  font-family: var(--mono);
  font-size: 13px;
  color: var(--text-dim);
  padding: 10px 0 0 0;
  letter-spacing: 1px;
}

/* ============ MODAL / POPUP ============ */
#grayout {
  display: none;
  position: fixed;
  inset: 0;
  z-index: 1000;
  background: rgba(0,0,0,0.75);
  backdrop-filter: blur(4px);
  animation: fade-in 0.2s ease;
}
@keyframes fade-in {
  from { opacity: 0; }
  to   { opacity: 1; }
}

#popup {
  position: absolute;
  top: 50%; left: 50%;
  transform: translate(-50%, -50%);
  background: var(--panel);
  border: 1px solid var(--border2);
  box-shadow: 0 0 60px rgba(0,0,0,0.8), 0 0 0 1px var(--amber-dim);
  width: min(500px, 90vw);
  border-radius: 4px;
  overflow: hidden;
  animation: popup-in 0.2s ease;
}
@keyframes popup-in {
  from { opacity: 0; transform: translate(-50%, calc(-50% + 8px)); }
  to   { opacity: 1; transform: translate(-50%, -50%); }
}

.popup-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 14px 18px;
  background: var(--bg2);
  border-bottom: 1px solid var(--border2);
  font-family: var(--display);
  font-size: 12px;
  color: var(--amber);
  letter-spacing: 2px;
}
.popup-header button {
  background: transparent;
  border: 1px solid var(--border2);
  color: var(--text-dim);
  cursor: pointer;
  width: 28px; height: 28px;
  border-radius: 2px;
  font-size: 13px;
  transition: all 0.15s;
}
.popup-header button:hover {
  border-color: var(--red);
  color: var(--red);
}

.popup-label {
  font-family: var(--mono);
  font-size: 11px;
  color: var(--text-dim);
  padding: 14px 18px 6px;
  letter-spacing: 0.5px;
}

.popup-link-wrap {
  padding: 8px 18px 18px;
}
.popup-link-wrap a {
  display: block;
  font-family: var(--mono);
  font-size: 11px;
  color: var(--amber);
  word-break: break-all;
  padding: 10px;
  background: var(--bg);
  border: 1px solid var(--border2);
  border-radius: 2px;
  text-decoration: none;
  transition: border-color 0.15s;
}
.popup-link-wrap a:hover {
  border-color: var(--amber);
}

/* ============ FOOTER ============ */
footer {
  position: fixed;
  bottom: 0; left: 0; right: 0;
  z-index: 100;
  background: var(--panel);
  border-top: 1px solid var(--border2);
  padding: 8px 24px;
  display: flex;
  align-items: center;
  gap: 10px;
  font-family: var(--mono);
  font-size: 10px;
  color: var(--text-dim);
  letter-spacing: 1px;
}
footer a {
  color: var(--amber);
  text-decoration: none;
  transition: color 0.15s;
}
footer a:hover { color: var(--text-bright); }
.footer-sep { color: var(--border2); }

/* ============ SCROLLBARS ============ */
::-webkit-scrollbar { width: 5px; height: 5px; }
::-webkit-scrollbar-track { background: var(--bg2); }
::-webkit-scrollbar-thumb { background: var(--border2); border-radius: 3px; }
::-webkit-scrollbar-thumb:hover { background: var(--amber-dim); }

/* ============ RESPONSIVE ============ */
@media (max-width: 720px) {
  #main-layout { flex-direction: column; }
  #settings-panel { width: 100%; min-width: unset; border-right: none; border-bottom: 1px solid var(--border2); }
  #output-panel { min-height: unset; }
  h1 { font-size: 17px; }
  .logo-wrap img { height: 52px; width: 52px; }
}
    </style>
  </head>
  <body>

    <div class="scanlines"></div>
    <div class="noise"></div>

    <div id="app">

      <!-- HEADER -->
      <header id="hdr">
        <div class="hdr-left">
          <div class="logo-wrap">
            <img src="/WB LOGO.png" alt="War Brokers Logo">
          </div>
          <div class="title-wrap">
            <h1>WAR BROKERS<br><span class="title-sub">SERVER MAPPER</span></h1>
            <div class="title-ver">v2.0 &mdash; 2026</div>
          </div>
        </div>
        <div class="hdr-right">
          <div class="hdr-stat">
            <span class="stat-label">STATUS</span>
            <span class="stat-val" id="status">STANDBY</span>
          </div>
        </div>
      </header>

      <div id="main-layout">

        <!-- LEFT PANEL: SETTINGS -->
        <aside id="settings-panel">

          <div class="panel-label">CONFIGURATION</div>

          <!-- Game + Alert row -->
          <div class="cfg-row">
            <div class="field-group">
              <label class="field-label">GAME MODE</label>
              <div class="select-wrap">
                <select id="game" onchange="if_4v4(this.id,'add_modes','modes_select','modes_list'); liveUpdate();">
                  <option value="classic" selected>Classic</option>
                  <option value="4v4">4v4</option>
                </select>
                <div class="select-arrow">&#9662;</div>
              </div>
            </div>

            <div class="field-group toggle-group">
              <label class="field-label">ALERT</label>
              <label class="toggle">
                <input type="checkbox" id="alert" onchange="liveUpdate()">
                <span class="toggle-track">
                  <span class="toggle-thumb"></span>
                </span>
              </label>
            </div>

            <div class="field-group">
              <button id="save" onclick="show_config()">
                <span class="btn-icon">&#8862;</span> SAVE CONFIG
              </button>
            </div>
          </div>

          <!-- Players -->
          <div class="cfg-section">
            <div class="section-header">
              <span class="section-tag">01</span>
              <span class="section-title">PLAYER FILTER</span>
            </div>
            <div class="players-row">
              <div class="select-wrap">
                <select id="sign" onchange="liveUpdate()">
                  <option value="Greater" selected>&ge; Greater</option>
                  <option value="Less">&le; Less</option>
                </select>
                <div class="select-arrow">&#9662;</div>
              </div>
              <span class="players-label">than or equal to</span>
              <div class="select-wrap narrow">
                <select id="players" onchange="liveUpdate()">
                  <option value="1" selected>1</option>
                  <option value="2">2</option>
                  <option value="3">3</option>
                  <option value="4">4</option>
                  <option value="5">5</option>
                  <option value="6">6</option>
                  <option value="7">7</option>
                  <option value="8">8</option>
                  <option value="9">9</option>
                  <option value="10">10</option>
                  <option value="11">11</option>
                  <option value="12">12</option>
                  <option value="13">13</option>
                  <option value="14">14</option>
                  <option value="15">15</option>
                  <option value="16">16</option>
                </select>
                <div class="select-arrow">&#9662;</div>
              </div>
              <span class="players-label">player(s)</span>
            </div>
          </div>

          <!-- Modes -->
          <div class="cfg-section filter-section" id="mode">
            <div class="section-header collapsible" onclick="collapse(0,'mode_img')">
              <span class="section-tag">02</span>
              <span class="section-title">GAME MODES</span>
              <span class="section-all" id="all_modes">ALL</span>
              <svg id="mode_img" class="chevron" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="18 15 12 9 6 15"></polyline></svg>
            </div>
            <div style="display:none" class="_add" id="add_modes">
              <div class="filter-body">
                <div class="_select" id="modes_select"></div>
                <div class="_find" id="modes_find">
                  <div class="search-bar">
                    <span class="search-icon">&#x2315;</span>
                    <input class="search-input" id="mode_search" type="text" placeholder="Search modes..." onkeyup="search('mode_search','modes_list')">
                    <button class="clear-btn" onclick="clearsearch('mode_search')">&#x2715;</button>
                  </div>
                  <div class="_list" id="modes_list"></div>
                </div>
              </div>
            </div>
          </div>

          <!-- Maps -->
          <div class="cfg-section filter-section">
            <div class="section-header collapsible" onclick="collapse(1,'map_img')">
              <span class="section-tag">03</span>
              <span class="section-title">MAPS</span>
              <span class="section-all" id="all_maps">ALL</span>
              <svg id="map_img" class="chevron" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="18 15 12 9 6 15"></polyline></svg>
            </div>
            <div style="display:none" class="_add" id="add_maps">
              <div class="filter-body">
                <div class="_select" id="maps_select"></div>
                <div class="_find" id="maps_find">
                  <div class="search-bar">
                    <span class="search-icon">&#x2315;</span>
                    <input class="search-input" id="map_search" type="text" placeholder="Search maps..." onkeyup="search('map_search','maps_list')">
                    <button class="clear-btn" onclick="clearsearch('map_search')">&#x2715;</button>
                  </div>
                  <div class="_list" id="maps_list"></div>
                </div>
              </div>
            </div>
          </div>

          <!-- Regions -->
          <div class="cfg-section filter-section">
            <div class="section-header collapsible" onclick="collapse(2,'reg_img')">
              <span class="section-tag">04</span>
              <span class="section-title">REGIONS</span>
              <span class="section-all" id="all_regions">ALL</span>
              <svg id="reg_img" class="chevron" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="18 15 12 9 6 15"></polyline></svg>
            </div>
            <div style="display:none" class="_add" id="add_regions">
              <div class="filter-body">
                <div class="_select" id="regions_select"></div>
                <div class="_find" id="regions_find">
                  <div class="search-bar">
                    <span class="search-icon">&#x2315;</span>
                    <input class="search-input" id="region_search" type="text" placeholder="Search regions..." onkeyup="search('region_search','regions_list')">
                    <button class="clear-btn" onclick="clearsearch('region_search')">&#x2715;</button>
                  </div>
                  <div class="_list" id="regions_list"></div>
                </div>
              </div>
            </div>
          </div>

          <!-- Start / Stop -->
          <button class="startstop-btn" id="startstop" value="start" onclick="startstop(this.id)">
            <span class="btn-pulse" id="btn-pulse"></span>
            <span class="btn-text">&#9654;&nbsp; INITIATE SCAN</span>
          </button>

        </aside>

        <!-- RIGHT PANEL: OUTPUT -->
        <section id="output-panel">
          <div class="panel-label">SCAN RESULTS</div>
          <div id="output-inner">
            <div class="output-idle" id="output-idle">
              <div class="idle-icon">&#9678;</div>
              <div class="idle-text">AWAITING SCAN</div>
              <div class="idle-sub">Configure filters and press INITIATE SCAN</div>
            </div>
            <div id="output"></div>
          </div>
        </section>

      </div>

    </div>

    <!-- Config Popup / Modal -->
    <div id="grayout">
      <div id="popup">
        <div class="popup-header">
          <span>&#8862; CONFIGURATION LINK</span>
          <button id="close_popup" onclick="close_config('grayout')">&#x2715;</button>
        </div>
        <p class="popup-label">Share or bookmark this URL to restore your current settings:</p>
        <div class="popup-link-wrap">
          <a id="saved_config" target="_blank" rel="noopener noreferrer"></a>
        </div>
      </div>
    </div>

    <footer>
      <span>WAR BROKERS MAPPER</span>
      <span class="footer-sep">|</span>
      <a href="https://github.com/DidYouGetSniped" target="_blank">Did You Get Sniped?</a>
      <span class="footer-sep">|</span>
      <span>War Brokers logo property of <a href="https://www.trebuchetent.com/" target="_blank">Trebuchet Entertainment LLC</a></span>
    </footer>

    <script>
// ============================================================
//  data.js
// ============================================================

let vars = {
  "game": "classic",
  "players": [true, 1],
  "mode": "",
  "map": "",
  "location": "",
  "playalert": true,
  "stop": false,
}
const Modes = {
    "tdm": 128,
    "ml": 138,
    "bd": 275,
    "cp": 135,
    "ve": 136,
    "gg": 15,
};
const Modes_long = {
    "Team Death Match": "tdm",
    "Missile Launch": "ml",
    "Bomb Disposal": "bd",
    "Capture Points": "cp",
    "Vehicle Escort": "ve",
    "Gun Game": "gg",
};
const Maps = {
    "area15base": 21,
    "area15bunker": 22,
    "citypoint": 13,
    "cologne": 44,
    "desert": 0,
    "escapes": 6,
    "flooded": 4,
    "frontier": 31,
    "goldmine": 47,
    "goldminev2": 49,
    "heist": 32,
    "kitchen": 29,
    "moonbase": 20,
    "northwest": 1,
    "office": 3,
    "pacific": 2,
    "remagen": 8,
    "siege": 39,
    "skullisland": 24,
    "southwest": 7,
    "spacestation": 38,
    "temple": 5,
    "thesomme": 15,
    "tomb": 14,
    "tribute": 18,
    "cyberpunk": 19,
    "zengarden": 43,
    "containers": 37,
    "crisscross": 40,
    "dwarfsdungeon": 28,
    "hanger": 25,
    "pyramid": 36,
    "quarry": 27,
    "sniperalley": 35,
    "snipersonly": 41,
    "threelane": 34,
    "towerofpower": 33,
};
const Maps_long = {
    "Area 15 Base": "area15base",
    "Area 15 Bunker": "area15bunker",
    "City Point": "citypoint",
    "Cologne": "cologne",
    "Desert": "desert",
    "Escape": "escapes",
    "Flooded": "flooded",
    "Frontier": "frontier",
    "Goldmine": "goldmine",
    "Goldmine V2": "goldminev2",
    "Heist": "heist",
    "Kitchen": "kitchen",
    "Moonbase": "moonbase",
    "Northwest": "northwest",
    "Office": "office",
    "Pacific": "pacific",
    "Remagen": "remagen",
    "Siege": "siege",
    "Skull Island": "skullisland",
    "Southwest": "southwest",
    "Space Station": "spacestation",
    "Temple": "temple",
    "The Somme": "thesomme",
    "Tomb": "tomb",
    "Tribute": "tribute",
    "Tribute (Cyberpunk)": "cyberpunk",
    "Zen Garden": "zengarden",
    "Containers": "containers",
    "Criss Cross": "crisscross",
    "Dwarf's Dungeon": "dwarfsdungeon",
    "Hanger": "hanger",
    "Pyramid": "pyramid",
    "Quarry": "quarry",
    "Sniper Alley": "sniperalley",
    "Snipers Only": "snipersonly",
    "Three Lane": "threelane",
    "Tower of Power": "towerofpower",
};
const classic = ["USA","USA_WEST","ASIA","JAPAN","EUROPE","INDIA","AUSTRALIA","RUSSIA"];
const fourvfour = ["USA_4V4","EU_4V4","ASIA_4V4"];

const Classic_maps = {
    "Area 15 Base": "area15base",
    "Area 15 Bunker": "area15bunker",
    "City Point": "citypoint",
    "Cologne": "cologne",
    "Desert": "desert",
    "Escape": "escapes",
    "Flooded": "flooded",
    "Frontier": "frontier",
    "Goldmine": "goldmine",
    "Goldmine V2": "goldminev2",
    "Heist": "heist",
    "Kitchen": "kitchen",
    "Moonbase": "moonbase",
    "Northwest": "northwest",
    "Office": "office",
    "Pacific": "pacific",
    "Remagen": "remagen",
    "Siege": "siege",
    "Skull Island": "skullisland",
    "Southwest": "southwest",
    "Space Station": "spacestation",
    "Temple": "temple",
    "The Somme": "thesomme",
    "Tomb": "tomb",
    "Tribute": "tribute",
    "Tribute (Cyberpunk)": "cyberpunk",
    "Zen Garden": "zengarden",
};
const Fourv4_maps = {
    "Containers": "containers",
    "Criss Cross": "crisscross",
    "Dwarf's Dungeon": "dwarfsdungeon",
    "Hanger": "hanger",
    "Pyramid": "pyramid",
    "Quarry": "quarry",
    "Sniper Alley": "sniperalley",
    "Snipers Only": "snipersonly",
    "Three Lane": "threelane",
    "Tower of Power": "towerofpower",
};
const Classic_regions = {
    "USA": "USA",
    "USA_WEST": "USA_WEST",
    "ASIA": "ASIA",
    "JAPAN": "JAPAN",
    "EUROPE": "EUROPE",
    "INDIA": "INDIA",
    "AUSTRALIA": "AUSTRALIA",
    "RUSSIA": "RUSSIA",
};
const Fourv4_regions = {
    "USA_4V4": "USA_4V4",
    "ASIA_4V4": "ASIA_4V4",
    "EU_4V4": "EU_4V4",
};

// ============================================================
//  index.js
// ============================================================

function loadparas() {
    const query = new URLSearchParams(window.location.search);
    const game = query.get("game");
    const alert = query.get("alert");
    const player = query.get("players");
    const mode = query.get("modes");
    const map = query.get("maps");
    const region = query.get("regions");

    const game_select = document.getElementById("game");

    if (game != null) {
        if (game.toLowerCase() == "classic") {
            game_select.selectedIndex = 0;
        } else if (game.toLowerCase() == "4v4") {
            game_select.selectedIndex = 1;
            if_4v4("game","add_modes","modes_select","modes_list")
        } else {
            console.error("Unknown game '" + game + "'")
        }
    }

    if (alert != null) {
        if (alert.toLowerCase() == "true") {
            document.getElementById("alert").checked = true;
        } else if (alert.toLowerCase() == "false") {
            document.getElementById("alert").checked = false;
        } else {
            console.error("Unknown parameter '" + alert + "'");
        }
    }

    if (player != null) {
        let sign = player.slice(0,1);
        let players = player.slice(1,player.length);
        if (sign.toLowerCase() == "g") {
            document.getElementById("sign").selectedIndex = 0;
        } else if (sign.toLowerCase() == "l") {
            document.getElementById("sign").selectedIndex = 1;
        } else {
            console.error("Unknown sign '" + sign + "'");
        }
        if (!isNaN(parseInt(players))) {
            if (parseInt(players) <= 16 && parseInt(players) >= 1) {
                document.getElementById("players").selectedIndex = parseInt(players) - 1;
            } else {
                console.error("'" + players + "' is out of range.")
            }
        } else {
            console.error("Unknown number '" + players + "'." )
        }
    }

    if (mode != null && game_select.selectedIndex != 1) {
        modes = mode.split(",");
        for (let i in modes) {
            let select = document.getElementById(modes[i]);
            if (select != null) {
              select.click();
            }
        }
    }

    if (map != null) {
        maps = map.split(",");
        for (let i in maps) {
            let select = document.getElementById(maps[i]);
            if (select != null) {
                select.click();
            }
        }
    }

    if (region != null) {
        regions = region.split(",");
        for (let i in regions) {
            let select = document.getElementById(regions[i].toUpperCase());
            if (select != null) {
                select.click();
            }
        }
    }
}

function setup(gameid, alertid, signid, playerid) {
    let game = document.getElementById(gameid);
    let alert = document.getElementById(alertid);
    let sign = document.getElementById(signid);
    let player = document.getElementById(playerid);

    game.selectedIndex = 0;
    alert.checked = true;
    sign.selectedIndex = 0;
    player.selectedIndex = 0;
}

function collapse(part, self) {
    let parts = ["modes", "maps", "regions"];
    let img_parts = ["mode", "map", "reg"];

    let id = document.getElementById("add_" + parts[part]);
    let chevron = document.getElementById(self);

    parts.splice(part, 1);
    img_parts.splice(part, 1);

    if (id.style.display === "none") {
        id.style.display = "block";
        chevron.classList.add("open");

        for (let i=0; i<parts.length; i++) {
            document.getElementById("add_" + parts[i]).style.display = "none";
            document.getElementById(img_parts[i] + "_img").classList.remove("open");
        }

    } else {
        id.style.display = "none";
        chevron.classList.remove("open");
    }
}

function search(value, list) {
    let input = document.getElementById(value).value.toLowerCase();
    let terms = document.getElementById(list);
    let button = terms.getElementsByTagName("button");
    for (let i=0; i<button.length; i++) {
        item = button[i].textContent.toLowerCase();
        if (item.indexOf(input) > -1) {
            button[i].style.display = "";
        } else {
            button[i].style.display = "none";
        }
    }
}

function clearsearch(input) {
    document.getElementById(input).value = "";
}

function remove(el, item, base) {
    let selection = item.innerHTML;
    let all = document.getElementById("all_" + base);
    let preview = ", " + all.textContent;

    item.disabled = false;
    el.remove();

    preview = preview.replace(", " + selection, "");

    if (preview[0] == ",") {
        preview = preview.slice(2);
    }

    if (preview == "") {
        preview = "ALL";
    }

    all.textContent = preview;
    liveUpdate();
}

function select(item, display, base) {
    let selection = document.getElementById(item);
    let show = document.getElementById(display);
    let id = selection.value + "_select";
    let all = document.getElementById("all_" + base);
    let preview = all.textContent;

    if (preview === "ALL") {
        preview = selection.innerHTML;
    } else {
        preview += ", " + selection.innerHTML;
    }

    all.textContent = preview;

    selection.disabled = true;

    show.innerHTML += `<span id="${id}"><a>${selection.innerHTML}</a> <button onclick="remove(${id},${item},'${base}')">X</button>&nbsp;&nbsp;<span>`

    liveUpdate();
}

function populate(base, list) {
    let id = base + "_list";
    let select = base + "_select"
    let modes = "";

    for (let i in list) {
        modes += `<button value="${list[i]}" id="${list[i]}" onclick="select(this.value,'${select}','${base}')">${i}</button>`
    }

    document.getElementById(id).innerHTML = "";
    document.getElementById(id).innerHTML = modes;
}

function if_4v4(id, add, select, list) {
    let game = document.getElementById(id);
    let mode = document.getElementById("mode");
    let modes = document.getElementById(add)
    let selected = document.getElementById(select);
    let listed = document.getElementById(list).getElementsByTagName('*');

    if (game.options[game.selectedIndex].text == "4v4") {
        mode.style.pointerEvents = "none";
        mode.style.backgroundColor = "gray";
        modes.style.display = "none";
        document.getElementById("mode_img").classList.remove("open")
        document.getElementById("all_modes").textContent = "ALL";
        document.getElementById("all_maps").textContent = "ALL";
        document.getElementById("all_regions").textContent = "ALL";

        selected.innerHTML = "";
        document.getElementById("maps_select").innerHTML = "";
        document.getElementById("regions_select").innerHTML = "";

        populate("maps", Fourv4_maps)
        populate("regions", Fourv4_regions)

        for (let i=0; i<listed.length; i++) {
            listed[i].disabled = false;
        }

    } else if (game.options[game.selectedIndex].text == "Classic") {
        mode.style.pointerEvents = "auto";
        mode.style.backgroundColor = "";

        populate("maps", Classic_maps)
        populate("regions", Classic_regions)
    }
}

function pre_data(gameid, alertid, signid, playersid) {
    let game = document.getElementById(gameid);
    let alert = document.getElementById(alertid);
    let sign = document.getElementById(signid);
    let players = document.getElementById(playersid);

    let select_game = game.options[game.selectedIndex].text;
    let select_alert = alert.checked;
    let select_sign = sign.options[sign.selectedIndex].text
    let select_players = players.options[players.selectedIndex].text

    if (select_sign == "Greater") {
        select_sign = true;
    } else if (select_sign == "Less") {
        select_sign = false;
    }

    vars["playalert"] = select_alert;
    vars["game"] = select_game;
    vars["players"] = [select_sign, parseInt(select_players)];
}

function collect_data(id) {
    let data = "";

    let list = document.getElementById(id);
    let button = list.getElementsByTagName("button");

    for (let i=0; i<button.length; i++) {
        if (button[i].disabled) {
            data += button[i].value + ",";
        }
    }

    data = data.slice(0, -1);
    return data;
}

// Live update vars from current UI state (used when scan is already running)
function liveUpdate() {
    pre_data('game', 'alert', 'sign', 'players');
    vars["mode"] = collect_data("modes_list");
    vars["map"] = collect_data("maps_list");
    vars["location"] = collect_data("regions_list");
}

function save_config() {
    let game = document.getElementById("game");
    let alert = document.getElementById("alert").checked;
    let sign = document.getElementById("sign").selectedIndex;
    let players = document.getElementById("players").selectedIndex;
    let modes = collect_data("modes_list");
    let maps = collect_data("maps_list");
    let regions = collect_data("regions_list");

    if (sign == 0) {
        sign = "G";
    } else {
        sign = "L";
    }

    let params = window.location.href.split("?")[0] + "?game=" + game[game.selectedIndex].value + "&alert=" + alert + "&players=" + sign + (players + 1).toString();

    if (modes != "") {
        params += "&modes=" + modes;
    }

    if (maps != "") {
        params += "&maps=" + maps;
    }
    if (regions != "") {
        params += "&regions=" + regions;
    }

    return params
}

function show_config() {
    let popup = document.getElementById("grayout");
    let link = document.getElementById("saved_config");

    link.textContent = save_config();
    link.href = save_config();
    popup.style.display = "block";
}

function close_config(id) {
    document.getElementById(id).style.display = "none";
}

function startstop(id) {
    let button = document.getElementById(id);

    if (button.value == "start") {
        liveUpdate();

        wb_mapper("output","status","startstop");

        document.getElementById("output").innerHTML = "";
        document.getElementById("status").innerHTML = "MAPPING...";

        button.querySelector('.btn-text').textContent = "⬛ STOP SCAN";
        button.value = "stop";
    } else if (button.value == "stop") {
        vars["stop"] = true;

        console.log("Stopping...");
        document.getElementById("status").innerHTML = "STOPPING...";

        button.querySelector('.btn-text').textContent = "▶ INITIATE SCAN";
        button.value = "start";
        button.disabled = true;
    } else {
        console.error("Bro, wut?!");
    }
}

document.addEventListener('visibilitychange', function(e) {
    if (!document.hidden) {
        document.title = "War Brokers Server Mapper";
    }
});

setup('game','alert','sign','players')
populate("modes", Modes_long)
populate("maps", Classic_maps)
populate("regions", Classic_regions)

loadparas();

// ============================================================
//  wb_mapper.js
// ============================================================

let endpoint = 303;
let minguess = 289;
let maxnumguess = 20;

async function fetch_server_data(region) {
  try {
    let failed = 1;
    let serverdata = [];
    let count = 0;
    
    while (failed) {
      if (count == maxnumguess) {
        console.error("Something went wrong. Please contact the developer. ")
        break;
      }
      
      const response = await fetch("https://store1.warbrokers.io/" + endpoint + "//server_list.php?location="+region);
  
      if (response.status == 404) {
        console.log("Endpoint: /" + endpoint + "//server_list.php returned 404. Retrying ...")

        if (count < 1) {
          endpoint = minguess;
        }

        endpoint += 1;
        count += 1;
        
        console.log("Trying: " + endpoint);
        continue;
      }

      if (!response.ok) {
        throw new Error('Network response was not ok');
      }

      failed = 0;
      
      serverdata = response.text().then(data => data.split(","+region+","));
    }
    
    return serverdata;
  }
  catch (error) {
    console.error(error);
  }
}

function set_data(game, players, mode, map, location) {
  let data = [];
  modes = mode;

  if (game.toLowerCase() != "classic" && game.toLowerCase() != "4v4") {
    console.error("Unknown game selected!");
  }

  let game_regions;

  if (game.toLowerCase() == "classic") {
    game_regions = classic;
  }
  else if (game.toLowerCase() == "4v4") {
    game_regions = fourvfour;
    modes = "";
  }

  data.push(game.toLowerCase());
  data.push(players);

  let striped_mode = mode.toLowerCase().split(" ").join("").split(",");

  if (modes == "") {
    data.push("all");
  }
  else if (striped_mode.every(key => Modes.hasOwnProperty(key))) {
    for (let i = 0; i < striped_mode.length; i++) {
      striped_mode[i] = Modes[striped_mode[i]];
    }
    data.push(striped_mode);
  }
  else {
    console.error("[ERROR]: Unknown mode selected!");
  }

  let striped_map = map.toLowerCase().split(" ").join("").split(",");

  if (map == "") {
    data.push("all");
  }
  else if (striped_map.every(key => Maps.hasOwnProperty(key))) {
    for (let i = 0; i < striped_map.length; i++) {
      striped_map[i] = Maps[striped_map[i]];
    }
    data.push(striped_map);
  }
  else {
    console.error("[ERROR]: Unknown map selected!");
  }

  if (location == "") {
    data.push(game_regions);
  }
  else if (location != "") {
    let striped_location = location.toUpperCase().split(" ").join("").split(",");

    if (striped_location.every(key => game_regions.includes(key))) {
      data.push(striped_location);
    }
  }
  else {
    console.error ("[ERROR]: Unknown regions selected! Check set game.");
  }

  return data;
}

function player_check(server_data, set_data) {
  const sign = set_data[1][0];
  const num = parseInt(set_data[1][1]);

  if (num == 0) {
    console.error("[ERROR]: Number of players cannot be zero!");
  }

  let players = [];
  for (let i = 1; i < server_data.length; i++) {
    x = server_data[i].split(",");
    players.push(parseInt(x[2]));
  }

  let check = [];

  for (let i=0; i<players.length; i++) {
    if (players[i] == 0) {
      check.push(0);
      continue;
    }
    else if (sign && players[i] >= num) {
      check.push(1);
    }
    else if (!sign && players[i] <= num) {
      check.push(1);
    }
    else {
      check.push(0);
    }
  }

  return check;
}

function mode_check(server_data, set_data) {
    const wanted = set_data[2];

    if (wanted == "all") {
        return true;
    }

    let modes = [];
    for (let i=1; i<server_data.length; i++) {
      x = server_data[i].split(",");
      modes.push(parseInt(x[1]));
    }

    let check = [];

    for (let i=0; i<modes.length; i++) {
      if (wanted.includes(modes[i]))
        check.push(1);
      else {
        check.push(0);
      }
    }

    return check
}

function map_check(server_data, set_data) {
  const wanted = set_data[3];

  if (wanted == "all") {
    return true;
  }

  let maps = [];
  for (let i=1; i<server_data.length; i++) {
    x = server_data[i].split(",");
    maps.push(parseInt(x[3]));
  }

  let check = [];
  for (let i=0; i<maps.length; i++) {
    if (wanted.includes(maps[i])) {
      check.push(1);
    }
    else {
      check.push(0);
    }
  }
  return check;
}

function outputLine(server_data, index, location) {
  const data = server_data[index+1].split(",");
  let player = parseInt(data[2]);
  let mode = parseInt(data[1]);
  let map = parseInt(data[3]);

  for (let i in Modes) {
    if (mode == Modes[i]) {
      for (let l in Modes_long) {
        if (i == Modes_long[l]) {
          mode = l.toUpperCase();
          break;
        }
      }
    }
    else {
      continue;
    }
  }

  for (let j in Maps) {
    if (map == Maps[j]) {
      for (let k in Maps_long)
        if (j == Maps_long[k]) {
          map = k.toUpperCase();
          break;
        }
    }
    else {
      continue;
    }
  }

  return `<li>${location} : ${mode} : ${map} : ${player} / 16 players</li>`
}

function game_check(server_data, set_data, region) {
  let check = 0;
  let str_output = "";

  player = player_check(server_data, set_data)
  mode = mode_check(server_data, set_data)
  map = map_check(server_data, set_data)

  if (mode == true) {
    mode = new Array(player.length).fill(1);
  }
  if (map == true) {
    map = new Array(player.length).fill(1);
  }

  for (let j=0; j<player.length; j++) {
    if (player[j] && mode[j] && map[j]) {
      str_output += outputLine(server_data, j, region);
      check += 1;
    }
    else {
      continue
    }
  }
  return [check, str_output];
}

function delay(ms) {
  return new Promise(resolve => setTimeout(resolve, ms));
}

function wb_mapper(id, status, button) {
(async () => {
  try {
    vars["stop"] = false;

    while (true) {

      if (vars["stop"]) {
        document.getElementById(status).innerHTML = "STOPPED";
        document.getElementById(button).disabled = false;
        console.log("Stopped.");
        return;
      }

      // Re-read settings each loop iteration for real-time updates
      let settings = set_data(vars["game"], vars["players"], vars["mode"], vars["map"], vars["location"]);

      let check = 0;
      let str_output = "<ul>";

      for (let i=0; i<settings[4].length; i++) {
        const server_data = await fetch_server_data(settings[4][i]);
        const wb_map = game_check(server_data, settings, settings[4][i]);

        if (server_data == []) {
          document.getElementById(status).innerHTML = "ERROR — please contact the developer";
          break;
        }
        
        check += wb_map[0];
        str_output += wb_map[1];
      }

      str_output += "</ul><div class='match-summary'>— Found " + check + " match" + (check == 1 ? "." : "es.") + "</div>";

      document.getElementById(id).innerHTML = str_output;

      if (check) {
        document.getElementById(status).innerHTML = "MATCH FOUND";

        document.getElementById(button).value = "start";
        document.getElementById(button).querySelector('.btn-text').textContent = "▶ INITIATE SCAN";
        document.getElementById(button).disabled = false;

        if (document.hidden) {
          document.title = "(1) War Brokers Server Mapper";
        }

        if (vars["playalert"]) {
          let audio = new Audio('sounds/alert.mp3');
          audio.play();
        }

        return;
      }

      document.getElementById(status).innerHTML = "SCANNING...";

      // Wait 30 seconds — DO NOT CHANGE THE 60, OR YOUR BROWSER WILL CRASH
      for (let i=0; i<60; i++) {
        await delay(500)
        if (vars["stop"]) {
          document.getElementById(status).innerHTML = "STOPPED";
          document.getElementById(button).disabled = false;
          console.log("Stopped.");
          return;
        }
      }

    }
  } catch (error) {
    console.error('Error in fetchData:', error);
  }

})();
}

// Hide idle on scan start
document.getElementById('startstop').addEventListener('click', function() {
  const idle = document.getElementById('output-idle');
  if (idle) idle.style.display = 'none';
});
    </script>

  </body>
</html>